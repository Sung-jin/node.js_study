#### 경로 표현식

* 경로표현식은 . 을 통해 객체 그래프를 탐색하는 것이다.
* JPQL 에서 . 을 통해 경로 표현식으로 쿼리를 작성할 수 있다.

```
SELECT m
FROM Member m
JOIN m.team t
JOIN m.orders o
WHERE ...
```

* 경로 표현식에는 다음과 같은 용어들이 있다.
    * 상태 필드 : 단순히 값을 저장하기 위한 필드 (필드 or 프로퍼티)
    * 연관 필드 : 연관관계를 위한 필드, 임베디드 타입 포함 (필드 or 프로퍼티)
        * 단순 값 연관 필드 : @ManyToOne, @OneToOne, 대상이 엔티티
        * 컬렉션 값 연관 필드 : @OneToMany, @ManyToMany, 대상이 컬렉션

```java
public class Entity {
    ...

    String field1;
    // 상태 필드

    @ManyToOne
    Parent parent;
    // 연관 필드 (단순 값)
    @OneToMany
    List<Child> children;
    // 연관 필드 (컬렉션)

    ...
}
```

##### 경로 표현식 특징

* 상태 필드 경로
    * 경로 탐색의 끝이며, 더이상 탐색할 수 없다.
    * SELECT e.field1, e.field2 ... FROM Entity e WHERE ...
    * e.field1, e.field2 가 상태 필드 경로 탐색이다.
* 단일 값 연관 경로
    * 묵시적으로 내부 조인이 일어나고, 계속 탐색할 수 있다.
    * SELECT e.parent FROM Entity e WHERE ...
    * e.parent 가 단일 값 연관 경로이며, parent 엔티티를 조회한다.
    * 변환된 쿼리 -> select p.* from Entity e inner join Parent p on e.parent = p.id
    * JPQL 쿼리에 별도의 join 이 없지만 변경된 SQL 에는 join 이 존재하는데, 이를 묵시적 조인이라 한다.
    * 참고로 묵시적 조인은 모두 내부 조인이다.
* 컬렉션 값 연관 경로
    * 묵시적으로 내부 조인이 일어난다.
    * 컬렉션 값을 경로 탐색을 시도할 수 없지만, FROM 절에서 조인을 통해 별칭을 얻으면 별칭으로 탐색할 수 있다.
        * SELECT e.child.field FROM Entity e ... (불가능)
        * SELECT c.field FROM Entity e JOIN e.child c ... (가능)
    * 컬렉션 연관 경로에는 .size 를 통해, 해당 컬렉션의 사이즈를 얻을 수 있다.
        * SELECT e.child.size FROM Entity e ... (child COUNT 값 리턴)

##### 경로 탐색을 사용한 묵시적 조인 시 주의사항

* 항상 내부 조인이다.
* 컬렉션은 경로 탐색의 끜이다.
    * 컬렉션에서 경로 탐색을 하기 위해서는, 조인을 통해 별칭을 만들어서 접근해야 한다.
* 경로 탐색은 주로 SELECT, WHERE 절에서 사용하지만, 묵시적 조인으로 인해 SQL 의 FROM 절에 영향을 준다.

#### 서브 쿼리

* JPQL 에도 서브쿼리가 지원되지만, 몇 가지 제약사항이 있다.
    * WHERE, HAVING 절에서만 서브쿼리를 사용할 수 있다.
    * SELECT, FROM 절에는 사용할 수 없다.
    * 하이버네이트의 HQL 은 SELECT 의 서브쿼리도 허용하고, 일부 JPA 구현체는 FROM 의 서브쿼리도 지원한다.

##### 서브 쿼리 함수

* EXIST
    * [NOT] EXIST (subquery)
    * 서브쿼리에 결과가 존재하면 참이고, NOT 을 붙이면 거짓을 리턴한다.
* { ALL | ANY | SOME }
    * 비교 연산자와 같이 사용한다.
    * ALL : 조건을 모두 만족하면 참
    * ANY|SOME : 조건 중 하나 이상 만족하면 참
    * SELECT m FROM Member m WHERE ANY (SELECT t FROM Team t)
* IN
    * [NOT] IN (subquery)
    * 서브쿼리의 결과 중 하나라도 같은 것이 있으면 참
    * 참고로 IN 은 서브쿼리가 아닌 곳에서도 사용한다.
