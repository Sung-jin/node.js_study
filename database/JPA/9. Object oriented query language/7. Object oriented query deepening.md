### 벌크 연산

* 여러건의 엔티티를 수정/삭제 등을 하나씩 처리하기에는 시간이 오래걸린다.
    * 이럴때 벌크 연산을 사용하면 된다.

```java
String qlString = """
    UPDATE Product p
    SET p.price = p.price * 1.1
    WHERE p.field < :field
"""

int resultCount = em.createQuery(qlString)
                    .setParameter("value", 100)
                    .executeUpdate();
// executeUpdate() 를 사용하면 벌크 연산을 한다.
// 삭제 쿼리를 사용할 때도 똑같이 executeUpdate() 를 사용하면 된다.
// JPA 표준은 아니지만, 하이버네이트는 insert 벌크 연산도 지원한다.
```

#### 벌크 연산의 주의점

* 벌크 연산시 영속성 컨텍스트를 무시하고 데이터베이스에 직접 쿼리한다.

```java
Product productA = em.createQuery("SELECT p FROM Product p WHERE p.name = :name", Product.class)
                    .setParameter("name", "value")
                    .getSingleResult();
// 현재 영속성 컨텍스에 저장된 엔티티의 field 가 1000 이라고 가정을 하자.

em.createQuery("UPDATE Product p SET p.field = p.field * 1.1")
    .executeUpdate();

// 벌크 연산 후에 영속성 컨텍스트에 존재하는 해당 엔티티들의 값은 업데이트 되지 않는다.
```

* 위와 같은 이슈에서 해결방안
    1. em.refresh() 사용
    2. 벌크 연산먼저 실행 후, 데이터 조회
    3. 벌크 연산 후 영속성 컨텍스트 초기화
