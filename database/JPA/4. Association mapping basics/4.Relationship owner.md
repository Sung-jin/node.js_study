# 연관관계 주인

* 엔티티를 양방향 연관관계로 설정하면 객체의 참조는 둘인데 외래 키는 하나이다.
* 두 객체 연관관계 중 하나를 정해서 테이블의 외래키를 관리해야 하는데, 이것을 연관관계의 주인이라 한다.

## 양방향 매핑의 규칙 - 연관관계의 주인

* 양방향 연관관계시, 꼭 두 관계중 하나를 연관관계의 주인으로 정해줘야만 한다.
* **연관관계 주인이 데이터베이스 연관관계와 매핑되고, 외래키를 관리할 수 있다.**
    * 연관관계 주인이 아닌쪽은, 읽기만 가능하다.
* 연관관계의 주인으로 정하는 방법은 mappedBy 속성을 통해 설정할 수 있다.
    * 연관관계 주인은 mappedBy 속성을 사용하지 않는다.

![inheritance model](../images/4.%20two-way%20relationship.png.png)

* 위 이미지에서 연관관계 주인은 누구로 정해야 할까?

> 연관관계 주인이 데이터베이스 연관관계와 매핑되고, 외래키를 관리할 수 있다.

* Member 테이블 안에, 외래키의 정보와 매핑정보가 있으므로 일반적으로는 Member 테이블이 연관관계의 주인이 된다.
    * Team 테이블이 연관관계의 주인이 될 수는 있지만, Team 테이블에 직접적으로 매핑되는 정보가 없으므로 해당 정보를 물리적으로 관리할 별도의 테이블이 관리해야 한다.

```java
class Team {
    @OneToMany(mappedBy="team")
    private List<Member> members = new ArrayList<Member>();
    // team 은 Member.team 이다.
}
```

## 정리

* 연관관계의 주인만 데이터베이스 연관관계와 매핑되고 외래 키를 관리할 수 있다.
* 주인이 아닌쪽은 읽기만 가능하고, 외래키를 변경하지는 못한다.
* 데이터베이스 테이블의 N:1, 1:N 관계에서 항상 N 쪽이 외래키를 가진다.
    * 즉, 다쪽인 @ManyToOne 은 항상 연관관계의 주인이 되므로, mappedBy 를 설정할 수 없으며 또한 해당 속성이 없다.
