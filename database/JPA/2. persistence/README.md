## 영속성 컨텍스트란?

* persistence context
* 엔티티 매니저로 엔티티를 저장하거나 조회하면 엔티티 매니저는 영속성 컨텍스트에 엔티티를 보관하고 관리한다.
* em.persist(entity); 를 사용할 때 엔티티 매니저를 사용해서 해당 엔티티를 영속성 컨텍스트에 저장하는 것이다.
* 그래서?
    1. 영속성 컨텍스트는 논리적인 개념에 가깝다.
    2. 엔티티 매니저를 생성할 때 하나 생성된다.
    3. 엔티티 매니저를 통해서 영속성 컨텍스트에 접근할 수 있고 관리할 수 있다.

## 엔티티의 생명주기

* 엔티티에는 4개의 상태가 존재한다.
    1. 비영속 (new/transient) : 영속성 컨텍스트와 전혀 관계가 없는 상태
    2. 영속 (managed) : 영속성 컨텍스트에 저장된 상태
    3. 준영속 (detached) : 영속성 컨텓ㄱ스트에 저장되었다가 분리된 상태
    4. 삭제 (removed) : 삭제된 상태

![entity life cycle](../images/2.%20entity%20life%20cycle.png)

* 비영속
    * 엔티티 객체를 생성한 상태이며, 저장 직전인 객체를 말한다.
    * 즉, 영속성 컨텍스트나 데이터베이스와는 전혀 관련이 없다.

```java
Member mebmer = new Member();
member.setId(1);
member.setName("오성진");
```

* 영속
    * 엔티티 매니저를 통해 엔티티 객체를 영속성 컨텍스트에 저장한 상태.
    * 영속성 컨텍스트가 관리하는 엔티티를 영속 상태라 한다.
    * 즉, **영속 상태라는 것은 영속성 컨텍스트에 의해 관리된다는 뜻** 이다.
* 준영속
    * 영속성 컨텍스트가 관리하던 영속 상태의 엔티티를 영속성 컨텍스트가 관리하지 않으면 준영속 상태가 된다.
    * em.detach(), em.close(), em.clear() 를 사용해서 영속성 컨텍스트를 준영속으로 만들거나, 닫거나, 초기화하면 영속 상태의 엔티티는 준영속 상태가 된다.
* 삭제
    * em.remove() 를 통해서 엔티티를 영속성 컨텍스트와 데잍처베이스에서 삭제한다.
