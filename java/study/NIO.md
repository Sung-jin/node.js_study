# New Input/Output

* Java 7 로 버전업하면서 IO 와 NIO 사이의 일관성 없는 클래스 설계를 바로 잡고, 비동기 채널 등의 네트워크 지원을 대폭 강화한 NIO.2 API 가 추가되었다.
* Nio2 패키지에 제공되지 않고, 기존 java.nio 하위 패키지에 통합되어 있다.
  1. java.nio.channels
  2. java.nio.charset
  3. java.nio.file

| NIO 패키지                 | 포함되어 있는 내용                            |
| ----------------------- | ------------------------------------- |
| java.nio                | 다양한 버퍼 클래스                            |
| java.nio.channels       | 파일 채널, TCP 채널, UDP 채널 등의 클래스          |
| java.nio.channels.spi   | java.nio.channels 패키지를 위한 서비스 제공자 클래스 |
| java.nio.charset        | 문자셋, 인코더, 디코더 API                     |
| java.nio.charset.spi    | java.nio.charset 패키지를 위한 서비스 제공자 클래스  |
| java.nio.file.attribute | 파일 및 파일 시스템의 속성에 접근하기 위한 클래스          |
| java.nio.file.spi       | java.nio.file 패키지를 위한 서비스 제공자 클래스     |

## IO vs NIO

| 구분            | IO         | NIO    |
| ------------- | ---------- | ------ |
| 입출력 방식        | 스트림 장식     | 채널 방식  |
| 버퍼 방식         | non-buffer | buffer |
| 비동기 방식        | X          | O      |
| 블로킹 / 넌클로킹 방식 | 블로킹만 지원    | 모두 지원  |

## 스트림 vs 채널

* IO 는 스트림 기반이다.
  * 출력과, 입력 스트림이 다르기 때문에 각각 스트림을 따로 생성해야 한다.
* NIO 는 채널 기반이다.
  * 양방향으로 입력과 출력이 가능하다.

## buffer vs non-buffer

* IO 에서 출력 스트림이 1 바이트를 쓰면 입력 스트림은 1 바이트를 읽는다.
* 이는 대체로 느리고, 이로인해 buffer 를 사용해서 복수 개의 바이트를 한번에 입/출력 할 수 있는 방식을 사용할 수 있다.
  * BufferedInputStream / BufferedOutputStream  을 이용할 수 있다.
* NIO 는 기본적으로 buffer 를 사용한다.
* IO 는 스트림에서 읽은 데이터를 즉시 처리한다.
  * 스트림으로부터 입력된 전체 데이터를 별도로 저장하지 않으면, 입력된 데이터의 위치를 이동해 가면서 자유롭게 이용할 수 없다.
* NIO 는 읽은 데이터를 무조건 버퍼에 저장하기 때문에 필요한 부분만 읽고 쓸 수 있다.

## 블록킹 vs 논블록킹

* IO
  * 입력 스트림의 read() 메소드를 호출하면 데이터가 입력되기 전까지 스레드는 블록킹 상태가 된다.
  * 출력 스트림의 write() 메소드를 호출하면 데이터가 출력되기 전까지 스레드는 블록킹된다.
  * 블록킹을 빠져나오려면 interrupt 는 할 수 없고, 스트림을 닫아야만 한다.
* NIO
  * 블록킹과 논블록킹 특징을 모두 가지고 있다.
  * NIO 의 논블로킹은 입출력 작업 준비가 완료된 채널만 선택해서 작업 스레드가 처리하기 때문에 작업 스레드가 블로킹 되지 않는다.
  * NIO 논블로킹의 핵심 객체는 multiplexor 인 selector 이다.
    * selector -> 복수 개의 채널 중에서 준비 완료된 채널을 선택하는 방법을 제공

## IO vs NIO

* NIO 는 불특정 다수의 클라이언트 연결 또는 멀티 파일들을 논블록킹이나 비동기로 처리할 수 있기 때문에 과도한 스레드 생성을 피하고 스레드를 효과적으로 사용할 수 있다는 장점이 존재한다.
* 운영체제의 버퍼를 이용한 입출력이 가능하기 때문에 입출력 성능이 향상된다.
* NIO 는 연결 클라이언트 수가 많고, 하나의 입출력 처리 작업이 오래 걸리지 않는 경우에 사용하는 것이 좋다.
* IO 는 대용량 데이터를 처리할 경우 유리하다.
* NIO 는 버퍼 할당 크기도 문제가 있고, 모든 입출력 작업에 버퍼를 무조건 사용해야 하므로 받는 즉시 처리하는 IO 보다 복잡하다.
* 연결 클라이언트 수가 적고, 전송되는 데이터가 대용량이면서 순차적으로 처리될 필요성이 있을 경우에는 IO 로 서버를 구성하는것이 좋다.